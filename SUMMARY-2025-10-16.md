# 📝 무료 마크다운 편집기 Chrome 확장 프로그램 - 2025-10-16 작업 요약

## 1️⃣ 프로그램 실행 프로세스 (원리)

### A. Chrome 확장 프로그램 구조 (Manifest V3)

```
manifest.json (확장 프로그램 설정)
├── action.default_popup → popup.html (팝업 모드)
├── side_panel.default_path → editor.html (사이드 패널 모드)
├── background.service_worker → background.js (백그라운드)
└── permissions: storage, sidePanel, api.github.com
```

### B. 실행 프로세스 흐름

#### **1단계: 확장 프로그램 로드**
```
사용자가 Chrome에서 확장 프로그램 로드
↓
manifest.json 읽기
↓
background.js 실행 (Service Worker 등록)
```

#### **2단계: 사용자 인터랙션**
```
사용자가 확장 프로그램 아이콘 클릭
↓
3가지 실행 모드 중 하나 선택:
  1) 팝업 모드 (기본) → popup.html
  2) 사이드 패널 모드 → editor.html (사이드)
  3) 새 탭 모드 → editor.html (전체 화면)
```

#### **3단계: UI 초기화**

**popup.html / editor.html 로드 순서:**
```html
1. HTML 파싱
   ├── 헤더 (제목, 버전, 툴바 버튼)
   ├── 편집 영역 (포맷 툴바 + 텍스트 에디터)
   ├── 미리보기 영역
   └── 푸터

2. CSS 로드 (인라인 스타일)
   ├── 라이트/다크 모드 스타일
   ├── 그리드 레이아웃 (편집기/미리보기)
   └── 업데이트 알림 스타일

3. JavaScript 로드 (순서 중요!)
   ├── markdown-parser.js (마크다운 → HTML 변환)
   ├── version-checker.js (GitHub 업데이트 확인)
   └── popup.js / editor.js (메인 로직)
```

#### **4단계: 데이터 로드 및 상태 복원**

**popup.js / editor.js 실행:**
```javascript
// 1. Chrome Storage에서 저장된 데이터 로드
chrome.storage.local.get(['markdown', 'darkMode', 'showPreview'], (result) => {
  // 2. 상태 복원
  markdown = result.markdown || 기본 텍스트
  darkMode = result.darkMode || false
  showPreview = result.showPreview || true

  // 3. UI 업데이트
  editor.value = markdown
  updatePreview()         // 마크다운 → HTML 렌더링
  applyDarkMode()         // 다크모드 적용
  applyPreviewToggle()    // 미리보기 표시/숨김
})
```

#### **5단계: 이벤트 리스너 등록**

```javascript
// 편집 이벤트
editor.addEventListener('input', () => {
  markdown = editor.value
  updatePreview()        // 실시간 미리보기 업데이트
  saveToStorage()        // Chrome Storage에 자동 저장
})

// 포맷 버튼 이벤트
formatBold.addEventListener('click', () => wrapSelection('**'))
formatItalic.addEventListener('click', () => wrapSelection('*'))
// ... 기타 포맷 버튼들

// 키보드 단축키
document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
    // Ctrl+B: 굵게
  }
  // ... 기타 단축키들
})
```

#### **6단계: 업데이트 확인 (백그라운드)**

**version-checker.js 실행:**
```javascript
// 페이지 로드 시 자동 실행
initUpdateCheck()
  ↓
// 6시간마다 체크 (localStorage로 관리)
lastCheck + 6시간 < 현재시간?
  ↓ Yes
GitHub API 호출: api.github.com/repos/yunuishung/mdeditor-chrome/releases/latest
  ↓
버전 비교: latestVersion > currentVersion?
  ↓ Yes
알림 표시 (30초간, ZIP 다운로드 + 릴리스 페이지 링크)
```

### C. 데이터 흐름 다이어그램

```
┌─────────────────────────────────────────────────┐
│  사용자 입력 (에디터에 마크다운 작성)              │
└────────────────┬────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────┐
│  editor.addEventListener('input')                │
│  → markdown = editor.value                       │
└────────────────┬────────────────────────────────┘
                 │
        ┌────────┴────────┐
        ▼                 ▼
┌─────────────┐  ┌──────────────────┐
│updatePreview│  │  saveToStorage() │
└──────┬──────┘  └────────┬─────────┘
       │                  │
       ▼                  ▼
┌──────────────────┐  ┌────────────────────┐
│markdown-parser.js│  │ chrome.storage.    │
│convertMarkdown   │  │ local.set()        │
│ToHtml()          │  │                    │
└──────┬───────────┘  └────────────────────┘
       │
       ▼
┌──────────────────────────────────┐
│  preview.innerHTML = HTML        │
│  (실시간 미리보기 렌더링)         │
└──────────────────────────────────┘
```

---

## 2️⃣ 오늘 작업한 수정사항 & 추가사항

### 📅 2025-10-16 작업 내역 (8개 커밋)

#### **커밋 1: Initial commit (1ea171a)**
```
✨ 기본 Chrome 확장 프로그램 구조 생성
- manifest.json (Manifest V3)
- popup.html/popup.js (팝업 모드)
- editor.html/editor.js (전체 화면 모드)
- markdown-parser.js (마크다운 파서)
- styles.css (스타일시트)
- 기본 기능: 실시간 미리보기, 다크모드, 파일 업로드/다운로드
```

#### **커밋 2: Fix icon error (23618d5)**
```
🐛 수정: 아이콘 파일 없어서 로딩 에러 발생
- manifest.json에서 icons 섹션 제거 (임시)
- 나중에 아이콘 생성 예정
```

#### **커밋 3: 다중 디스플레이 모드 추가 (8864334)**
```
✨ 추가: 4가지 실행 모드
1. 팝업 모드 (800x600 고정 크기)
2. 사이드 패널 모드 (지속적, 옆에 고정)
3. 크기 조절 가능한 창 모드
4. 새 탭 전체 화면 모드

✨ 추가: 키보드 단축키
- Ctrl+S: 저장
- Ctrl+B: 굵게
- Ctrl+I: 기울임
- Ctrl+K: 링크
- Ctrl+D: 다운로드
- Ctrl+Shift+C: 복사
- Ctrl+E: 미리보기 전환
- Ctrl+Shift+D: 다크모드 전환

📝 파일 추가:
- background.js (사이드 패널 관리)
```

#### **커밋 4: 마크다운 포맷 툴바 + 자동 업데이트 (2fa774a)**
```
✨ 추가: 마크다운 포맷 툴바
- 굵게, 기울임, 취소선 버튼 (SVG 아이콘)
- H1, H2, H3 제목 버튼
- 링크, 이미지 삽입 버튼
- 인라인/블록 코드 버튼
- 목록, 인용문, 구분선 버튼
- 툴바 구분선

✨ 추가: GitHub 기반 자동 업데이트 체크
- version-checker.js 생성
- GitHub API 호출 (releases/latest)
- 24시간마다 체크 (localStorage)
- 10초간 알림 표시

📝 포맷 함수 구현:
- wrapSelection(): 선택 영역 감싸기 (**텍스트**)
- replaceSelection(): 선택 영역 교체
- insertAtLineStart(): 줄 시작 부분에 추가 (# )
```

#### **커밋 5: CSP 에러 수정 + 버전 표시 (3a44cd4)**
```
🐛 수정: Content Security Policy 위반
- HTML에서 인라인 <script> 제거
- initUpdateCheck() 호출을 JS 파일로 이동

✨ 추가: 헤더에 버전 표시
- chrome.runtime.getManifest().version 사용
- "📝 무료 마크다운 편집기 v1.0.0" 형식
```

#### **커밋 6: 업데이트 알림 개선 (614e8d3)**
```
🔧 수정: 알림 타이밍 개선
- 체크 간격: 24시간 → 6시간
- 알림 표시 시간: 10초 → 30초
- 사용자가 클릭할 수 있는 충분한 시간 제공

✨ 추가: 수동 체크 함수
- window.checkForUpdatesNow() 콘솔 명령어
- 테스트용으로 localStorage 초기화
```

#### **커밋 7: ZIP 다운로드 + 릴리스 페이지 링크 (d3d4177)**
```
✨ 추가: 이중 다운로드 옵션
- GitHub 릴리스에서 .zip 파일 자동 감지
- zipAsset.browser_download_url 추출

🎨 UI 개선:
- 주요 버튼: "ZIP 다운로드" (파란색)
- 보조 버튼: "릴리스 페이지" (회색)
- 3차 버튼: "나중에" (연한 회색)

📝 스타일 추가:
- .update-btn-tertiary 클래스
- 다크모드 지원
```

#### **커밋 8: CSP 위반 최종 수정 (bb46907)**
```
🐛 수정: onclick 인라인 핸들러 제거
- <button onclick="..."> → addEventListener
- update-close 버튼
- update-later 버튼
- CSP 완전 준수
```

---

## 3️⃣ 주요 기능 목록 (최종)

### 핵심 기능
| 기능 | 설명 | 관련 파일 |
|------|------|-----------|
| ✏️ **실시간 편집** | 마크다운 입력 시 즉시 미리보기 업데이트 | editor.js, markdown-parser.js |
| 👁️ **미리보기 토글** | 편집기 전용 모드 ↔ 분할 화면 모드 | editor.js:96-104 |
| 🎨 **다크모드** | 라이트/다크 테마 전환, 상태 저장 | editor.js:154-162, styles.css |
| 📁 **파일 업로드** | .md/.txt 파일 불러오기 | editor.js:120-132 |
| 💾 **파일 다운로드** | document.md로 저장 | editor.js:135-145 |
| 📋 **클립보드 복사** | 마크다운 텍스트 복사 | editor.js:107-117 |
| 🔄 **자동 저장** | Chrome Storage에 1초 지연 저장 | editor.js:81-87 |

### 포맷 툴바
| 버튼 | 기능 | 단축키 | 구현 |
|------|------|--------|------|
| **B** | 굵게 | Ctrl+B | `**텍스트**` |
| *I* | 기울임 | Ctrl+I | `*텍스트*` |
| ~~S~~ | 취소선 | - | `~~텍스트~~` |
| H1/H2/H3 | 제목 | - | `# `, `## `, `### ` |
| 🔗 | 링크 | Ctrl+K | `[텍스트](URL)` |
| 🖼️ | 이미지 | - | `![설명](URL)` |
| `</>` | 코드 | - | \`코드\` or \`\`\`코드\`\`\` |
| • | 목록 | - | `- 항목` |
| " | 인용문 | - | `> 인용` |
| ─ | 구분선 | - | `---` |

### 실행 모드
| 모드 | 활성화 방법 | 특징 |
|------|-----------|------|
| 🔳 **팝업** | 확장 아이콘 클릭 | 800x600 고정, 빠른 접근 |
| 📌 **사이드 패널** | "사이드 패널로 열기" 버튼 | 웹페이지 옆에 고정 |
| 🪟 **리사이징 창** | "크기 조절 가능한 창" 버튼 | 자유 크기 조절 |
| 🖥️ **전체 화면** | "새 탭에서 열기" 버튼 | 넓은 작업 공간 |

### 자동 업데이트
| 기능 | 세부 사항 |
|------|----------|
| 🔍 **체크 주기** | 6시간마다 자동 체크 |
| 📍 **API 엔드포인트** | `api.github.com/repos/yunuishung/mdeditor-chrome/releases/latest` |
| 📦 **다운로드 옵션** | ZIP 파일 직접 다운로드 + GitHub 페이지 링크 |
| ⏱️ **알림 표시** | 30초간 표시 (애니메이션, 닫기/나중에 버튼) |
| 🧪 **수동 체크** | 콘솔에서 `checkForUpdatesNow()` 실행 |

---

## 4️⃣ 기술 스택 & 아키텍처 결정

### 기술 선택 이유

| 기술 | 선택 이유 |
|------|----------|
| **Vanilla JS** | 빌드 과정 없음, 가볍고 빠름, React 제거 |
| **Manifest V3** | Chrome의 최신 표준 (V2는 2024년 지원 종료) |
| **인라인 CSS** | 빌드 도구 없이 간단한 구조, Tailwind CDN 제거 |
| **Chrome Storage API** | 로컬 저장, 여러 모드 간 데이터 동기화 |
| **GitHub API** | 무료, 인증 불필요한 public repo, releases 기능 |
| **정규식 파서** | 외부 라이브러리 없이 마크다운 파싱, 가벼움 |

### 주요 아키텍처 결정

```
1. 빌드 과정 없음
   - 모든 파일이 직접 실행 가능
   - npm, webpack, babel 불필요

2. 상태 관리: Chrome Storage
   - localStorage 대신 chrome.storage.local 사용
   - 여러 탭/창 간 동기화

3. CSP 준수
   - 인라인 스크립트 금지
   - onclick 대신 addEventListener
   - eval() 사용 금지

4. 모듈화된 JavaScript
   - markdown-parser.js: 파싱 전용
   - version-checker.js: 업데이트 전용
   - editor.js/popup.js: UI 로직
```

---

## 5️⃣ 파일 구조 (최종)

```
mdeditor-chrome/
├── manifest.json           # 확장 프로그램 설정 (Manifest V3)
│
├── popup.html              # 팝업 모드 UI
├── popup.js                # 팝업 모드 로직
├── styles.css              # 팝업 스타일
│
├── editor.html             # 전체 화면/사이드 패널 UI (인라인 CSS)
├── editor.js               # 전체 화면 로직
│
├── markdown-parser.js      # 마크다운 → HTML 변환기
├── version-checker.js      # GitHub 업데이트 확인
├── background.js           # Service Worker (사이드 패널 관리)
│
├── .gitignore              # Git 제외 파일 (.claude/)
├── CLAUDE.md               # Claude Code 프로젝트 가이드
├── RELEASE.md              # 버전 릴리스 가이드
└── SUMMARY-2025-10-16.md   # 오늘 작업 요약 (이 파일)
```

---

## 6️⃣ 알려진 이슈 & 해결 방법

### ⚠️ CSP 오류 (해결됨)
**증상:** "Refused to execute inline script because it violates CSP"
**원인:** onclick 인라인 핸들러, 인라인 `<script>` 태그
**해결:** 모든 이벤트를 addEventListener로 변경

### ⚠️ 브라우저 캐싱 문제
**증상:** 코드 수정했는데 오류가 계속 발생
**원인:** Chrome이 이전 버전 캐싱
**해결:**
1. chrome://extensions/ → 확장 프로그램 제거
2. Chrome 재시작
3. 확장 프로그램 다시 로드

### ⚠️ 아이콘 누락 (임시 해결)
**증상:** 아이콘 로딩 에러
**현재 상태:** manifest.json에서 icons 섹션 제거
**향후 작업:** icon.svg를 16/48/128px PNG로 변환 필요

---

## 7️⃣ 다음 단계 (권장)

1. **아이콘 생성** - 16x16, 48x48, 128x128 PNG
2. **Chrome Web Store 출시** - $5 등록비 필요
3. **다국어 지원** - i18n API 사용 (한국어/영어)
4. **설정 페이지** - 테마 색상, 폰트 크기 커스터마이징
5. **내보내기 포맷 확장** - PDF, HTML 내보내기
6. **클라우드 동기화** - Google Drive 연동 (선택사항)

---

## 📊 통계

- **총 커밋:** 8개
- **작업 시간:** 약 6-7시간 (추정)
- **코드 줄 수:** 약 1,500줄
- **파일 수:** 10개
- **지원 마크다운 문법:** 12가지 (제목, 굵게, 기울임, 취소선, 링크, 이미지, 코드, 목록, 인용문, 구분선)
- **현재 버전:** v1.1.0

---

## 🎯 학습 포인트

1. **Chrome Extension Manifest V3**: Service Worker, Storage API, Side Panel API
2. **Content Security Policy (CSP)**: 인라인 스크립트 금지, 이벤트 리스너 패턴
3. **상태 관리**: chrome.storage.local을 이용한 영속성 및 동기화
4. **정규식 기반 파서**: 외부 의존성 없는 경량 마크다운 파싱
5. **GitHub API 활용**: 자동 업데이트 체크 메커니즘
6. **모듈화 패턴**: 관심사의 분리 (parsing, updating, UI logic)
